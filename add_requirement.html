<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>تسجيل اشتراط جديد</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body style="font-family: sans-serif; text-align:center; padding:20px;">
  <h2>📝 تسجيل اشتراط تصديري جديد</h2>

  <input id="country" placeholder="اسم الدولة" /><br/><br/>
  <input id="crop" placeholder="اسم المحصول" /><br/><br/>
  <input id="summary" placeholder="ملخص الاشتراطات" /><br/><br/>
  <textarea id="full_conditions" placeholder="الاشتراطات الكاملة"></textarea><br/><br/>
  <input type="file" id="pdfFile" accept="application/pdf" /><br/><br/>
  <button onclick="addRequirement()">حفظ الاشتراط</button>

  <script>
    const supabase = window.supabase.createClient(
      "https://uulzslgyqygvtpfgeecr.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV1bHpzbGd5cXlndnRwZmdlZWNyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3NzM4ODEsImV4cCI6MjA3NTM0OTg4MX0.VLJ_R6aKKz39AvZphb0JGVspUpw--l2JNzrk5yuNwkQ"
    );

    async function addRequirement() {
      const country = document.getElementById('country').value;
      const crop = document.getElementById('crop').value;
      const summary = document.getElementById('summary').value;
      const full_conditions = document.getElementById('full_conditions').value;
      const file = document.getElementById('pdfFile').files[0];
      let pdf_url = null;

      if (file) {
        const { data: uploadData, error: uploadError } = await supabase
          .storage.from('pdfs')
          .upload(requirements/${Date.now()}_${file.name}, file);

        if (uploadError) {
          alert('فشل رفع الملف');
          return;
        }

        const { data: publicUrlData } = supabase
          .storage.from('pdfs')
          .getPublicUrl(uploadData.path);

        pdf_url = publicUrlData.publicUrl;
      }

      const { error } = await supabase
        .from('export_requirements')
        .insert([{ country_name: country, crop_name: crop, summary, full_conditions, pdf_url }]);

      if (error) {
        alert('فشل الحفظ');
      } else {
        alert('تم الحفظ بنجاح');
      }
    }
  </script>
</body>
</html>